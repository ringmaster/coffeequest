{
  "steps": [
    {
      "id": "Town Square",
      "tags": [
        "!q:merchant",
        "!done:merchant"
      ],
      "vars": {
        "valuable": [
          "gemstone",
          "heirloom",
          "artifact"
        ],
        "victim": [
          {
            "occupation": "merchant",
            "gender": "male"
          },
          {
            "occupation": "trader",
            "gender": "male"
          },
          {
            "occupation": "shopkeeper",
            "gender": "male"
          },
          {
            "occupation": "seamstress",
            "gender": "female"
          },
          {
            "occupation": "priest",
            "gender": "male"
          }
        ]
      },
      "text": "You arrive at the town square.  You see a {{victim.occupation}} who is looking quite glum.  {{victim.He}} explains, \"Thieves stole my precious {{valuable}}! I am pretty sure they are hiding in the Old Mill. Please help me recover it!\"",
      "options": [
        "I'll help you::accept_merchant_quest",
        "Sorry, I'm busy"
      ]
    },
    {
      "id": "accept_merchant_quest",
      "tags": [
        "+q:merchant",
        "+quest"
      ],
      "text": "The {{victim.occupation}} looks hopeful. \"Thank you! Please hurry to the Old Mill to the east.\"",
      "log": "Agreed to help the {{victim.occupation}} recover {{victim.his}} {{valuable}}"
    },
    {
      "id": "Town Square",
      "tags": [
        "q:merchant"
      ],
      "text": "The {{victim.occupation}} is happy to see you've returned to the Town Square.  \"Have you recovered my {{valuable}} from the thieves?\", {{victim.he}} asks, and is disappointed when you tell {{victim.him}} you haven't.  \"I am pretty sure they fled to the Old Mill. If you hurry, they might still be there!\""
    },
    {
      "id": "Old Mill",
      "tags": [
        "@q:merchant"
      ],
      "text": "You arrive at the Old Mill. You hear voices inside.",
      "options": [
        {
          "label": "Sneak in quietly",
          "tags": [],
          "skill": "guile",
          "dc": 4,
          "pass": "mill_sneak_success",
          "fail": "mill_sneak_fail"
        },
        {
          "label": "Burst in aggressively",
          "tags": [],
          "skill": "might",
          "dc": 5,
          "pass": "mill_might_success",
          "fail": "mill_might_fail"
        },
        {
          "label": "Try to talk to them",
          "tags": [],
          "pass": "mill_negotiate"
        }
      ]
    },
    {
      "id": "mill_sneak_success",
      "tags": [
        "+inv:{{valuable}}",
        "+trait:sneaky"
      ],
      "text": "You slip past the thieves unnoticed and find the {{valuable}} unprotected!  You are able to grab it and leave without being seen.",
      "log": "Sneaked into the mill and recovered the {{valuable}}"
    },
    {
      "id": "mill_sneak_fail",
      "tags": [],
      "text": "The thieves hear you! One blocks your path.",
      "options": [
        {
          "label": "Fight",
          "tags": [],
          "skill": "might",
          "dc": 6,
          "pass": "mill_fight_win",
          "fail": "mill_fight_lose"
        },
        {
          "label": "Flee",
          "tags": [],
          "pass": "mill_flee"
        }
      ]
    },
    {
      "id": "mill_might_success",
      "tags": [
        "+inv:{{valuable}}",
        "+trait:warrior"
      ],
      "text": "You intimidate the thieves into surrendering the {{valuable}}!",
      "log": "Intimidated the thieves and recovered the {{valuable}}"
    },
    {
      "id": "mill_might_fail",
      "tags": [
        "+status:injured"
      ],
      "text": "The thieves overpower you. You barely escape with your life.",
      "log": "Failed to recover the {{valuable}} and got injured"
    },
    {
      "id": "mill_negotiate",
      "tags": [],
      "text": "You approach peacefully. The thieves are willing to talk.",
      "options": [
        {
          "label": "Offer them 3 silver for the item",
          "tags": [
            "inv:silver",
            "inv:silver",
            "inv:silver"
          ],
          "pass": "mill_purchase"
        },
        {
          "label": "Threaten them",
          "tags": [],
          "skill": "might",
          "dc": 8,
          "pass": "mill_might_success",
          "fail": "mill_might_fail"
        },
        {
          "label": "Walk away",
          "tags": [],
          "pass": "mill_give_up"
        }
      ]
    },
    {
      "id": "mill_purchase",
      "tags": [
        "-inv:silver",
        "-inv:silver",
        "-inv:silver",
        "+inv:{{valuable}}"
      ],
      "text": "The thieves accept your silver and hand over the {{valuable}}.",
      "log": "Bought the {{valuable}} from the thieves for 3 silver"
    },
    {
      "id": "mill_fight_win",
      "tags": [
        "+inv:{{valuable}}",
        "+trait:warrior"
      ],
      "text": "You defeat the thief and claim the {{valuable}}!",
      "log": "Fought the thieves and recovered the {{valuable}}"
    },
    {
      "id": "mill_fight_lose",
      "tags": [
        "+status:injured",
        "+trait:beaten_by_thieves"
      ],
      "text": "The thief beats you soundly. You limp away empty-handed.",
      "log": "Lost the fight and failed to recover the {{valuable}}"
    },
    {
      "id": "mill_flee",
      "tags": [
        "+trait:coward"
      ],
      "text": "You run from the mill. The thieves laugh at your cowardice.",
      "log": "Fled from the thieves in fear"
    },
    {
      "id": "mill_give_up",
      "tags": [],
      "text": "You leave the mill without the {{valuable}}."
    },
    {
      "id": "Town Square",
      "tags": [
        "@inv:{{valuable}}"
      ],
      "text": "The {{victim.occupation}} is overjoyed to see {{victim.his}} {{valuable}} returned!",
      "options": [
        {
          "label": "Accept reward",
          "tags": [],
          "pass": "merchant_reward"
        }
      ]
    },
    {
      "id": "merchant_reward",
      "tags": [
        "-inv:{{valuable}}",
        "+inv:orange",
        "+inv:orange",
        "+inv:orange",
        "-quest",
        "+done:merchant"
      ],
      "vars": {
        "valuable": null
      },
      "text": "The {{victim.occupation}} gives you a bag of ripe oranges and {{victim.his}} eternal gratitude!",
      "log": "Returned the item stolen from the {{victim.occupation}} and earned a bag of oranges"
    },
    {
      "id": "merchant_reward",
      "tags": [
        "-inv:{{valuable}}",
        "+inv:silver",
        "+inv:silver",
        "-quest",
        "+done:merchant"
      ],
      "vars": {
        "valuable": null
      },
      "text": "The {{victim.occupation}} gives you 2 silver and their eternal gratitude!",
      "log": "Returned the {{victim.occupation}}'s stolen item and earned 2 silver"
    },
    {
      "id": "Town Square",
      "tags": [
        "@status:injured",
        "@q:merchant",
        "!inv:{{valuable}}",
        "-quest",
        "+done:merchant"
      ],
      "text": "The merchant sees your injuries and sighs sadly. 'I appreciate you tried...'",
      "log": "Returned to the merchant empty-handed"
    },
    {
      "id": "Town Square",
      "tags": [
        "@trait:coward",
        "@q:merchant",
        "!inv:{{valuable}}",
        "-quest",
        "+done:merchant"
      ],
      "text": "\"You ran away?\" The {{victim.occupation}} shakes {{victim.his}} head in disbelief. \"Well, I guess you tried.\"",
      "log": "Returned to the merchant empty-handed"
    }
  ]
}
